# Server Health Monitor n8n Workflow

This repository contains an **n8n workflow** designed for automated server health monitoring, anomaly detection, AI-driven remediation recommendations, and team alerting via Slack.

## Features

- **Automated Monitoring**: Uses a schedule trigger to periodically check server health via SSH.
- **AI-Assisted Diagnosis**: Sends server logs and metrics to an AI assistant to identify root causes, suggest remediation actions, and provide shell commands.
- **Slack Notifications**: Notifies the team on Slack with a concise summary and actionable commands.
- **Automated Remediation**: Extracts recommended shell commands from AI output and executes them automatically on the target server.
- **Intelligent Alerting**: Aggregates and formats issues and suggested actions for clear communication.

## Workflow Overview

1. **Trigger**: The workflow is initiated on a schedule.
2. **Check Server Health**: Executes `python3 /server_monitor.py` on the server via SSH to collect health data.
3. **AI Analysis**: Sends collected metrics to an OpenAI model, which:
    - Diagnoses causes of issues,
    - Suggests actions (`restart_service`, `scale_resources`, `clear_cache`, or `escalate`),
    - Identifies affected services,
    - Returns remediation shell commands in a strict JSON format.
4. **Slack Alert Formatting**: Parses the AI output and formats a Slack message with the findings and actions.
5. **Slack Notification**: Posts the alert in a designated Slack channel.
6. **Command Extraction & Execution**: Extracts commands from the Slack message and executes them on the server.
7. **Post-Remediation Actions**: Executes an additional automation script (`python3 /auto.py`), then summarizes issues and proposed actions.
8. **Final Notification**: Posts a final summary message in Slack.

## Files

- [`workflow.json`](./workflow.json): The n8n workflow file (import into your n8n instance).
- [`README.md`](./README.md): This documentation.

## Usage

1. **Import the Workflow**: Download `workflow.json` and import it into your n8n instance.
2. **Configure Credentials**:
    - Set up SSH credentials for your server(s).
    - Set up OpenAI API credentials.
    - Set up Slack API credentials and specify your channel.
3. **Customize Server Scripts**:
    - Ensure `/server_monitor.py` and `/auto.py` exist and are executable on your server. Adjust commands if your scripts are named differently.
4. **Activate the Workflow**: Enable the workflow in n8n.
5. **Monitor Alerts**: Watch your designated Slack channel for real-time health alerts, diagnoses, and remediation instructions.

## AI Output Format

The AI assistant **must** return responses in this strict JSON format:

```json
{
  "cause": "string",
  "action": "restart_service|scale_resources|clear_cache|escalate",
  "service": "string|null",
  "commands": ["string"] // array of shell commands
}
```

## Example Slack Message

```
:warning: *Server Healing Alert*

*Cause:* Out of memory
*Action:* scale_resources
*Service:* nginx
*Commands to Execute:*
`sudo systemctl restart nginx`
`sudo systemctl restart memcached`
```

## License

MIT License

---

*Generated by Copilot for Alok77it*
